---
title: CVE-2025-66689 분석
author: P0LESTAR
date: 2026-01-15 00:01:01 +0800
categories: [CVE]
tags: [CVE, CVE-2025-63603, MCP취약점]
#pin: true
sitemap:
  changefreq: monthly
  priority: 0.5
---

> 위 CVE는 K-Shield Jr. 프로젝트에서 발견한 취약점입니다.
{: .prompt-info }

## URL

BeehiveInnovations 사의 `pal-mcp`에서 발견한 취약점입니다.

<https://www.cve.org/CVERecord?id=CVE-2025-66689>

<https://github.com/BeehiveInnovations/pal-mcp-server/pull/353>


## 설명
Pal MCP Server의 파일 읽기 기능에서 경로 탐색(Path Traversal) 취약점이 발견되었으며, 이를 통해 사용자가 시스템의 임의 파일을 읽을 수 있습니다. (9.8.2 버전 미만)

`is_dangerous_path()` 함수의 불충분한 경로 검증으로 인해 블랙리스트에 등록된 경로의 하위 디렉토리에 접근하여 우회할 수 있습니다.

<br><br>

---

## Vulnerability

### Vulnerable Code Location

**파일**: `utils/security_config.py`

```python
DANGEROUS_PATHS = {
    "/",
    "/etc",
    "/usr",
    "C:\\\\",
    "C:\\\\Windows",      # C:\\Windows 자체만 차단됨
    "C:\\\\Program Files",
    "C:\\\\Users",
}

def is_dangerous_path(path: Path) -> bool:
    try:
        resolved = path.resolve()
        # ❌ 정확히 일치하는 문자열만 검사 - 하위 디렉토리는 차단되지 않음
        return str(resolved) in DANGEROUS_PATHS or resolved.parent == resolved
    except Exception:
        return True

```

**파일**: `utils/file_utils.py` → `resolve_and_validate_path()`

이 함수는 `is_dangerous_path()`를 호출하지만 검증이 불충분합니다:

```python
def resolve_and_validate_path(path_str: str) -> Path:
    user_path = Path(path_str)

    if not user_path.is_absolute():
        raise ValueError("Relative paths are not supported...")

    resolved_path = user_path.resolve()

    # ❌ 정확히 일치하는 경우만 차단하는 블랙리스트 방식
    if is_dangerous_path(resolved_path):
        raise PermissionError(f"Access to system directory denied: {path_str}")

    return resolved_path

```

### Root Cause 

1. **정확한 문자열 매칭**: `"C:\\\\Windows"`는 `C:\\Windows`만 차단하고 `C:\\Windows\\System32\\drivers\\etc\\`는 차단하지 못함
2. **블랙리스트 방식**: 모든 위험한 경로를 예측할 수 없음
3. **하위 디렉토리 검사 부재**: 경로가 위험한 디렉토리 하위에 있는지 확인하는 로직 누락

### 공격 플로우

```
사용자 입력 (chat tool)
    ↓
SimpleTool.execute()
    ↓
prepare_prompt() → read_files()
    ↓
read_file_content()
    ↓
resolve_and_validate_path()  ← 취약한 함수
    ↓
is_dangerous_path()          ← 우회됨!
    ↓
open(file, 'r')              ← 임의 파일 읽기
```

<br><br>

---

## PoC

![](assets\img\cve-2025-66689(1).png)

![](assets\img\cve-2025-66689(2).png)

<br><br>

---

### Patch

1. 정확한 문자열 매칭에서 접두사 매칭으로 전환
- 이전: 시스템은 제한된 목록과 정확히 일치하는 경로만 차단했습니다 (예: C:\Windows). 이로 인해 C:\Windows\System32\...와 같은 하위 디렉토리에 대한 접근이 제대로 제한되지 않는 취약점이 발생했습니다.
- 이후: 접두사 매칭을 사용하도록 로직이 업데이트되었습니다. 입력 경로가 제한된 디렉토리로 시작하는지 확인함으로써, 블랙리스트에 등록된 위치 내의 모든 하위 파일 및 디렉토리에 대한 접근을 효과적으로 차단합니다.

2. 크로스 플랫폼 호환성을 위한 Path.is_relative_to() 구현
- 운영 체제마다 다른 경로 구분자(슬래시 / vs. 백슬래시 \)로 인해 발생하는 문제를 해결하기 위해, 시스템은 이제 Python의 `Path.is_relative_to()` 메서드를 활용합니다.
- 이를 통해 요청된 파일이 OS 환경에 관계없이 제한된 "위험 구역" 내에 있는지 확인하여 더욱 강력하고 안전한 경로 비교가 가능해집니다.
